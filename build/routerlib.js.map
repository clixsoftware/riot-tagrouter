{"version":3,"sources":["router_tags_es6.js"],"names":["riot","tag2","opts","self","navigateToRoute","e","preventDefault","route","to","title","replace","on","Object","keys","tags","length","parent","setRoute","path","component","$appRoot","currTag","_isRouteRendedered","routeParams","unmountCurrRoute","unmount","createRouteWithTagName","tagName","tag","innerHTML","mountedTag","window","render","mount","setTimeout","trigger","Function","changeRoute","newRoute","result","Promise","then","tokenRegExp","params","match","map","param","substring","serverSidePath","RegExp","loc","location","test","matches","shift","forEach","index","start","showRoutes","routeContainer","refs","riotcontainer","remove","riotroot","baseRoute","base","root","getBasePath"],"mappings":"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","file":"routerlib.js","sourcesContent":["riot.tag2('navigate', '<a href=\"{document.querySelector(\\'router\\').getBasePath()+opts.to}\" onclick=\"{navigateToRoute}\"><yield></yield></a>', '', '', function(opts) {\n        var self = this;\n        this.navigateToRoute = function(e){\n            e.preventDefault();\n            riot.route(self.opts.to,self.opts.title||null,self.opts.replace?true:false);\n        }\n});\nriot.tag2('route', '<yield></yield>', '', '', function(opts) {\n\t\t\t\tthis.on('mount',(e) => {\n\t\t\t\t\t\tif(Object.keys(this.tags).length===0){\n\t\t\t\t\t\t\tthis.parent && this.parent.setRoute && this.parent.setRoute(this.opts.path, this.opts.component );\n\t\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.setRoute = function(path, component){\n\t\t\t\t\tthis.parent && this.parent.setRoute && this.parent.setRoute(this.opts.path + path, component );\n\t\t\t\t}\n});\nriot.tag2('router', '<div ref=\"riotcontainer\" class=\"route-container\"><yield></yield></div><div ref=\"riotroot\" class=\"riot-root\"></div>', '', '', function(opts) {\n\t\t\t\tvar self = this;\n\t\t\t\tvar $appRoot = null;\n\t\t\t\tvar currTag = null;\n\n\t\t\t\tvar _isRouteRendedered = false;\n\t\t\t\tvar routeParams = {};\n\n\t\t\t\tfunction unmountCurrRoute(){\n\t\t\t\t\t\tif(currTag && currTag.unmount){\n\t\t\t\t\t\t\t\t\tcurrTag.unmount();\n\t\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction createRouteWithTagName(tagName){\n\n\t\t\t\t\t\tvar tag = '<'+tagName+' class=\"route-'+tagName+'\"></'+tagName+'>';\n\n\t\t\t\t\t\tunmountCurrRoute();\n\n\t\t\t\t\t\t$appRoot.innerHTML = tag;\n\t\t\t\t\t\tvar mountedTag;\n\t\t\t\t\t\ttry{\n\t\t\t\t\t\t\tif(typeof window === 'undefined'){\n\n\t\t\t\t\t\t\t\t$appRoot.innerHTML = riot.render(tagName,routeParams);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tmountedTag = riot.mount(tagName + '.route-' + tagName, routeParams);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch(e){\n\n\t\t\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\t\t\tthrow(e);\n\t\t\t\t\t\t\t},0);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(!mountedTag || mountedTag.length === 0){\n\t\t\t\t\t\t\t\tself.trigger('tagNotFound',tagName);\n\t\t\t\t\t\t\t\tif(self.opts['onTagnotfound'] && self.opts['onTagnotfound'] instanceof Function){\n\t\t\t\t\t\t\t\t\tself.opts['onTagnotfound'](tagName);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse{\n\t\t\t\t\t\t\t\tself.trigger('routeChanged',tagName);\n\t\t\t\t\t\t\t\tif(self.opts['onRoutechange'] && self.opts['onRoutechange'] instanceof Function){\n\t\t\t\t\t\t\t\t\tself.opts['onRoutechange'](tagName);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcurrTag = mountedTag[0];\n\t\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction changeRoute(newRoute){\n\t\t\t\t\t\tif(typeof(newRoute) === 'string'){\n\t\t\t\t\t\t\t\tcreateRouteWithTagName(newRoute);\n\t\t\t\t\t\t} else if (newRoute instanceof Function){\n\t\t\t\t\t\t\t\tvar result = newRoute();\n\t\t\t\t\t\t\t\tif(typeof(result) === 'string'){\n\t\t\t\t\t\t\t\t\tcreateRouteWithTagName(newRoute);\n\t\t\t\t\t\t\t\t} else if(result instanceof Promise){\n\t\t\t\t\t\t\t\t\tresult.then(tagName  => {\n\t\t\t\t\t\t\t\t\t\tcreateRouteWithTagName(tagName);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.setRoute = function(path, component){\n\t\t\t\t\t\t(function(path, component){\n\n\t\t\t\t\t\t\t\tvar tokenRegExp = /:([a-z]*)/ig;\n\n\t\t\t\t\t\t\t\tvar params = path.match(tokenRegExp);\n\t\t\t\t\t\t\t\tparams = params && params.map(param => param.length>0 ? param.substring(1): '') || params;\n\n\t\t\t\t\t\t\t\tpath = path.replace(tokenRegExp,'*');\n\n\t\t\t\t\t\t\t\tif(typeof window === 'undefined' && !_isRouteRendedered){\n\t\t\t\t\t\t\t\t\tvar serverSidePath = new RegExp(path.replace(/\\*/g,'([^/?#]+?)').replace(/\\.\\./g,'.*')+'$');\n\t\t\t\t\t\t\t\t\tvar loc = self.opts.location || self.parent&&self.parent.opts.location;\n\n\t\t\t\t\t\t\t\t\tif(serverSidePath.test(loc)){\n\t\t\t\t\t\t\t\t\t\tvar matches=loc.match(serverSidePath)\n\t\t\t\t\t\t\t\t\t\tmatches.length&&matches.shift();\n\n\t\t\t\t\t\t\t\t\t\trouteParams = {};\n\t\t\t\t\t\t\t\t\t\tparams && params.forEach(function (param, index) {\n\t\t\t\t\t\t\t\t\t\t\t\trouteParams[param] = matches[index];\n\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t_isRouteRendedered = true;\n\t\t\t\t\t\t\t\t\t\tchangeRoute(component);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t} else if(typeof window !== 'undefined') {\n\n\t\t\t\t\t\t\t\t\triot.route(path,function() {\n\n\t\t\t\t\t\t\t\t\t\t\trouteParams={};\n\n\t\t\t\t\t\t\t\t\t\t\tparams && params.forEach((param,index) => {\n\t\t\t\t\t\t\t\t\t\t\t\trouteParams[param] = arguments[index];\n\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\tchangeRoute(component);\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\triot.route.start(true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})(path, component)\n\t\t\t\t}\n\n\t\t\t\tthis.on('mount',(e)=>{\n\n\t\t\t\t\t\tif(!this.opts.showRoutes){\n\t\t\t\t\t\t\tvar routeContainer = this.refs.riotcontainer;\n\t\t\t\t\t\t\trouteContainer.remove && routeContainer.remove();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$appRoot = this.refs.riotroot;\n\n\t\t\t\t\t\tthis.opts.baseRoute && riot.route.base(this.opts.baseRoute);\n\n\t\t\t\t\t\tthis.root.getBasePath = function(){\n\t\t\t\t\t\t\treturn self.opts.baseRoute||'#';\n\t\t\t\t\t\t}\n\t\t\t\t});\n});\n\n"]}